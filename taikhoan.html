<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th√¥ng tin c√° nh√¢n</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="style/style_taikhoan.css">
    <script defer src="script.js"></script>
    
</head>
<body>
    <Header>
        <div class="daudo">
            <div class="dau">
                <div class="logo">
                    <a id="lam" href="index.html">NH<span class="chu_o">o</span>M7</a>
                </div>
                <div class="search-container">
                    <div class="search-box">
                        <span class="search-icon">üîç</span>
                        <input type="text" placeholder="T√¨m ki·∫øm ·ªü ƒë√¢y" id="searchInput">
                        <button id="searchButton">T√¨m Ki·∫øm</button>
                    </div>
                </div>
            
                <script>
                    document.getElementById("searchButton").addEventListener("click", function() {
                        let searchValue = document.getElementById("searchInput").value;
                        alert("B·∫°n ƒë√£ t√¨m ki·∫øm: " + searchValue);
                    });
                </script>
            </div>
            <div class="giohang_taikhoan">
                <a href="giohang.html" class="giohang_taikhoan-item">
                    <div class="giohang-icon">
                        üõí
                        <span class="cart-count">0</span>
                    </div>
                    <p>Gi·ªè H√†ng</p>
                </a>
        
                <a href="taikhoan.html" class="giohang_taikhoan-item">
                    <img id="userAvatar" class="user-avatar" src="anh/avt_trang.png" alt="Avatar">
                    <p id="usernameDisplay">T√†i kho·∫£n</p>
                </a>
            </div>
        </div>
        <script src="script.js"></script>
    </Header>
    <main>
        <div class="breadcrumb" style="font-family: 'Inter', sans-serif; margin-top: 20px; margin-left: 10%; padding-bottom: 1%;">
            <a href="" style="font-size: 28px; padding-right: 10px; color: black;">TH√îNG TIN C√Å NH√ÇN</a> <a href="index.html" style="color: rgba(0, 0, 0, 0.388); font-size: 10px;">TRANG CH·ª¶</a> / <span style="color: black; font-weight: bold; font-size: 12px;">TH√îNG TIN C√Å NH√ÇN</span>
        </div>
        <div class="bodytt">
            <div class="container">
                <aside class="sidebar">
                    <div class="profile-card">
                        <img id="avatar" src="anh/black15.jpg" alt="Avatar" class="avatar">
                        <h3 id="user-name">T√™n ng∆∞·ªùi d√πng</h3>
                        <p id="user-phone">S·ªë ƒëi·ªán tho·∫°i</p>
                        <!-- <a href="#">Xem h·ªì s∆°</a> -->
                        <!-- <div class="promotion">
                            <p>Qu√Ω kh√°ch ch∆∞a l√† th√†nh vi√™n t·∫°i FPT Shop</p>
                            <p>Quan t√¢m Zalo FPT Shop ƒë·ªÉ k√≠ch ho·∫°t ƒëi·ªÉm th∆∞·ªüng</p>
                            <button class="btn">Quan t√¢m ngay</button>
                        </div> -->
                    </div>
                    <nav class="menu">
                        <ul>
                            <li><a href="donhang.html">ƒê∆°n h√†ng c·ªßa t√¥i</a></li>
                            <li><a href="#" id="logout">ƒêƒÉng xu·∫•t</a></li>
                        </ul>
                    </nav>
                </aside>
                <main class="content">
                    <div class="profile-info">
                        <img id="profile-avatar" src="anh/avt_trang.png" alt="Avatar" class="profile-avatar">
                        <div class="info">
                            <p><strong>H·ªç v√† t√™n: </strong><span id="name">T√™n ng∆∞·ªùi d√πng</span></p> <br>
                            <p><strong>S·ªë ƒëi·ªán tho·∫°i:</strong> <span id="phone">S·ªë ƒëi·ªán tho·∫°i</span></p> <br>
                            <p><strong>Email:</strong> <span id="email">Email</span></p> <br>
                            <p><strong>ƒê·ªãa ch·ªâ:</strong> <span id="address">Ch∆∞a c√≥</span></p> <br>
                            <p><strong>Gi·ªõi t√≠nh:</strong> <span id="gender">Kh√¥ng x√°c ƒë·ªãnh</span></p> <br> <br> <br>
                            <button id="edit-btn" class="btn">Ch·ªânh s·ª≠a th√¥ng tin</button>         
                        </div>
                        
                    </div>
                </main>
            </div>
        
            <div id="edit-modal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h2>Ch·ªânh s·ª≠a th√¥ng tin</h2>
                    <label>H·ªç v√† t√™n: <input type="text" id="edit-name"></label>
                    <label>S·ªë ƒëi·ªán tho·∫°i: <input type="text" id="edit-phone"></label>
                    <label>Email: <input type="email" id="edit-email"></label>
                    <label>ƒê·ªãa ch·ªâ: <input type="text" id="edit-address"></label>
                    <label>Gi·ªõi t√≠nh: <input type="text" id="edit-gender"></label>
                    <div class="upload-container">
                        <label for="avatar-upload">Ch·ªçn ·∫£nh ƒë·∫°i di·ªán</label>
                        <input type="file" id="avatar-upload" accept="image/*">
                    </div>
                    
                    <button id="save-btn" class="btn">L∆∞u thay ƒë·ªïi</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
    let loggedInUser = localStorage.getItem("loggedInUser");
    if (!loggedInUser) {
        window.location.href = "dangnhap.html";
        return;
    }

    let users = JSON.parse(localStorage.getItem("users")) || [];
    let userData = users.find(user => user.username === loggedInUser);
    if (!userData) {
        window.location.href = "dangnhap.html";
        return;
    }

    document.getElementById("name").innerText = userData.username;
    document.getElementById("phone").innerText = userData.sdt;
    document.getElementById("email").innerText = userData.email;
    document.getElementById("address").innerText = userData.address || "Ch∆∞a c√≥";
    document.getElementById("gender").innerText = userData.gender || "Kh√¥ng x√°c ƒë·ªãnh";
    document.getElementById("user-name").innerText = userData.username;
    document.getElementById("user-phone").innerText = userData.sdt;
    document.getElementById("avatar").src = userData.avatar || "avatar.png";
    document.getElementById("profile-avatar").src = userData.avatar || "avatar.png";

    document.getElementById("edit-btn").addEventListener("click", function () {
        document.getElementById("edit-name").value = userData.username;
        document.getElementById("edit-phone").value = userData.sdt;
        document.getElementById("edit-email").value = userData.email;
        document.getElementById("edit-address").value = userData.address || "";
        document.getElementById("edit-gender").value = userData.gender || "";
        document.getElementById("edit-modal").style.display = "block";
    });

    document.getElementById("save-btn").addEventListener("click", function () {
    let newUsername = document.getElementById("edit-name").value.trim();
    let newPhone = document.getElementById("edit-phone").value.trim();
    let newEmail = document.getElementById("edit-email").value.trim();
    let newAddress = document.getElementById("edit-address").value.trim();
    let newGender = document.getElementById("edit-gender").value.trim();

    if (users.some(u => u.username === newUsername && u.username !== userData.username)) {
        alert("T√™n ƒëƒÉng nh·∫≠p ƒë√£ t·ªìn t·∫°i. Vui l√≤ng ch·ªçn t√™n kh√°c.");
        return;
    }

    if (users.some(u => u.email === newEmail && u.email !== userData.email)) {
        alert("Email ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng. Vui l√≤ng ch·ªçn email kh√°c.");
        return;
    }

    let phoneRegex = /^[0-9]+$/;
    if (!phoneRegex.test(newPhone)) {
        alert("S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá! Vui l√≤ng ch·ªâ nh·∫≠p s·ªë.");
        return;
    }

    let oldAvatar = userData.avatar || "avatar.png";

    userData.username = newUsername;
    userData.sdt = newPhone;
    userData.email = newEmail;
    userData.address = newAddress;
    userData.gender = newGender;
    userData.avatar = oldAvatar; 

    let updatedUsers = users.map(user => (user.username === loggedInUser ? userData : user));
    localStorage.setItem("users", JSON.stringify(updatedUsers));

    if (newUsername !== loggedInUser) {
        localStorage.setItem("loggedInUser", newUsername);
    }

    alert("C·∫≠p nh·∫≠t th√¥ng tin th√†nh c√¥ng!");
    location.reload();
});


    document.querySelector(".close").addEventListener("click", function () {
        document.getElementById("edit-modal").style.display = "none";
    });

    document.getElementById("logout").addEventListener("click", function () {
         localStorage.removeItem("loggedInUser");
        alert("üëã ƒê√£ ƒëƒÉng xu·∫•t!");
       window.location.href = "dangnhap.html";
     });
});


    </script>
    <script src="script/count.js"></script>
</body>
</html>